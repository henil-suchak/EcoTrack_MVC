@model EcoTrack.WebMvc.ViewModels.DashboardViewModel

@{
    ViewData["Title"] = "My Dashboard";
}

<div class="row mb-4">
    <div class="col-md-8">
        <h1>Welcome, @Model.UserProfile.Name!</h1>
        <p class="lead">Here's a summary of your carbon footprint.</p>
    </div>
    <div class="col-md-4 text-md-end">
        <a asp-action="Edit" asp-controller="Users" asp-route-id="@Model.UserProfile.UserId" class="btn btn-primary mt-2">Edit Profile</a>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <h3>Recent Activities</h3>
        @if (Model.RecentActivities.Any())
        {
            <ul class="list-group">
                @foreach (var activity in Model.RecentActivities.Take(5))
                {
                    <li class="list-group-item">
                        @activity.GetDescription()
                        <span class="badge bg-secondary float-end">@activity.CarbonEmission.ToString("F2") kg CO‚ÇÇ</span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p>No activities logged yet.</p>
        }
    </div>
    <div class="col-md-6">
        <h3>New Suggestions</h3>
        @if (Model.UnreadSuggestions.Any())
        {
            <ul class="list-group">
                @foreach (var suggestion in Model.UnreadSuggestions)
                {
                    <li class="list-group-item">@suggestion.Description</li>
                }
            </ul>
        }
        else
        {
            <p>No new suggestions.</p>
        }
    </div>
</div>
<div class="col-lg-4 mb-4">
    <div class="card h-100">
        <div class="card-header">üèÜ My Rankings</div>
        <div class="card-body">
            <h5 class="card-title">Weekly</h5>
            <p class="card-text fs-3">Rank: @(Model.WeeklyRankInfo?.Rank.ToString() ?? "N/A")</p>
            <hr>
            <h5 class="card-title">Monthly</h5>
            <p class="card-text fs-3">Rank: @(Model.MonthlyRankInfo?.Rank.ToString() ?? "N/A")</p>
        </div>
         <div class="card-footer">
            <a asp-controller="Leaderboard" asp-action="Index" class="btn btn-sm btn-outline-primary">View Full Leaderboard</a>
        </div>
    </div>
</div>
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                üèÜ My Badges
            </div>
            <div class="card-body">
                @if(Model.EarnedBadges.Any())
                {
                    <div class="d-flex flex-wrap">
                        @foreach (var badge in Model.EarnedBadges)
                        {
                            <div class="text-center p-2" 
                                 data-bs-toggle="tooltip" 
                                 title="@badge.Description (Earned: @badge.DateEarnedDisplay)">
                                <img src="@badge.IconUrl" alt="@badge.Name" width="60" />
                                <div style="font-size: 0.8rem;">@badge.Name</div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p>You haven't earned any badges yet. Keep up the great work!</p>
                }
            </div>
            <div class="card-footer">
                <a asp-controller="Badges" asp-action="Index" class="btn btn-sm btn-outline-primary">View All Badges</a>
            </div>
        </div>
    </div>
</div>